name: Simple Working Mac VNC
on: workflow_dispatch

jobs:
  mac-vnc:
    runs-on: macos-latest
    steps:
      - name: Setup VNC
        run: |
          brew install x11vnc
          mkdir -p ~/.vnc
          x11vnc -storepasswd "${{ secrets.VNC_PASSWORD }}" ~/.vnc/passwd
          x11vnc -create -forever -shared -rfbauth ~/.vnc/passwd &
          sleep 5

      - name: Setup noVNC
        run: |
          git clone https://github.com/novnc/noVNC.git
          cd noVNC

          # ã‚·ãƒ³ãƒ—ãƒ«ãªèµ·å‹•æ–¹æ³•
          ./utils/launch.sh --vnc localhost:5900 --listen 6080 &
          sleep 10

      - name: Setup ngrok
        run: |
          brew install ngrok
          ngrok config add-authtoken ${{ secrets.NGROK_AUTH_TOKEN }}
          ngrok http 127.0.0.1:6080 &
          sleep 10

          URL=$(curl -s http://127.0.0.1:4040/api/tunnels | jq -r '.tunnels[0].public_url')

          echo "=========================================="
          echo "ğŸ“ URL: $URL/vnc.html"
          echo "ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å: ä¸è¦"
          echo "ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: Your VNC_PASSWORD"
          echo "=========================================="

      - name: Keep Alive
        run: sleep 21600
